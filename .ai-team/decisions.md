# Decisions

> Shared decision log. All agents read this before starting work. Scribe merges new entries from the inbox.

### 2026-02-19: Provisioning error category analysis — comprehensive findings
**By:** Frodo
**What:** Analyzed 90,086 azd provisioning failures over the last 90 days from Kusto telemetry (DevCli database). Found 26 distinct error categories with ARM deployment failures dominating at 61% (54,839 errors). The overall provisioning failure rate is stable at ~52% over 12 months with no improvement trend. Top failing named templates are AI/ML-heavy: azure-search-openai-demo (7,384 failures, 55% rate), azure-gpt-rag (2,362 failures, 80% rate), and deploy-your-ai-application-in-production (341 failures, 77% rate). At the Azure service level, Storage (10% fail rate), Web/ServerFarms (9.6%), and ContainerInstance (8.3%) have the highest per-resource failure rates. Throttling (HTTP 429) is a major contributor across AppConfiguration, Storage, NetworkSecurityGroups, and Web resources. Identified ~40% of errors as fixable by template authors through static analysis checks, ~17% fixable in AZD tooling (retry logic, pre-checks), ~17% fixable via documentation/guidance, and ~10% not directly fixable (platform issues, user subscription state).
**Why:** Template Doctor needs data-driven prioritization for which analyzer checks to build. This analysis provides the evidence base: Bicep compilation checks (8,778 errors), SKU/quota risk detection, ARM pre-flight validation (15,199 errors), role assignment verification (2,064 errors), and PowerShell hook validation (4,915 errors) are the highest-impact checks to implement first. The persistence of the ~52% failure rate over 12 months demonstrates that the problem is not self-correcting and requires systematic intervention through tooling.

### 2026-02-19: Provisioning fix strategy — architectural plan
**By:** Gandalf
**What:** Comprehensive four-workstream plan to systematically eliminate `azd up` provisioning failures. Adds a `provisioning` category to the analyzer with 10 new static checks (local auth detection, soft-delete risk, parameter validation, azure.yaml deep validation, quota-risky SKU detection, resource dependency ordering, Container App config, hook scripts, agents.md presence). Complements the 8 AZD issues filed by Shayne Boyer with static analysis that catches problems before deployment starts. Includes template repo fixes (Workstream A), analyzer checks (Workstream B), AZD coordination (Workstream C), and documentation/guidance (Workstream D).
**Why:** Zero provisioning checks exist today in the analyzer. The `azd up` success rate on gallery templates is roughly 70%. By adding static detection of the patterns that cause ARM deployment failures (local auth enforcement, soft-delete conflicts, missing parameter defaults, misconfigured azure.yaml, quota-constrained SKUs), we can warn template owners and file fix PRs before users ever hit these errors. The modular check architecture (`packages/analyzer-core/src/checks/provisioning.ts`) also sets a precedent for decomposing the monolithic `runAnalyzer()` function, making future check development faster. Phased execution (6 weeks) ensures P0 checks (framework + local auth + soft-delete) ship first, with lower-priority checks following in weeks 3-6.

### 2026-02-19: Risk review of provisioning error analysis and fix plan
**By:** Sauron
**What:** Identified 2 CRITICAL risks, 6 HIGH risks, and 10 MEDIUM risks across Frodo's provisioning error analysis and Gandalf's fix plan. Critical findings: (1) Frontend category rendering in `adapt.ts` and `dashboard-renderer.ts` is hardcoded to 6 categories — adding `provisioning` in the backend without updating frontend will silently miscategorize all provisioning issues under Repository Management. (2) Check B4 (Bicep parameter validation) has estimated 40-60% false positive rate due to requiring `@description` on all params, which most real templates don't have. Additional high risks: B7 (dependency ordering) is infeasible with regex, compliance percentage regression on all templates, no staged rollout strategy, and batch scan false positives could generate 50-200 wrong GitHub issues on template repos.
**Why:** The frontend hardcoded category issue is CRITICAL because it is a guaranteed regression — Gandalf's plan incorrectly states "Frontend category tiles render automatically for new categories" but code inspection proves otherwise (adapt.ts lines 75-80, dashboard-renderer.ts lines 492-499 both use static arrays). B4's FP rate is CRITICAL because flagging nearly every template in the gallery as non-compliant would erode trust and render the provisioning category meaningless. Recommendations: fix frontend in same PR as B1, cut B7 entirely, scope-reduce B4, implement shadow mode lifecycle, set 5% FP threshold, and test against 50+ real templates before enabling any check.

